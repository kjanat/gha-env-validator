name: "Setup Project"
description: "Setup Node.js, Bun, install dependencies, and optionally build - with type-safe env validation"
author: "@kjanat"

inputs:
  node-version:
    description: "Node.js version to use"
    required: false
    default: "lts/*"

  bun-version:
    description: "Bun version to use"
    required: false
    default: "latest"

  skip-build:
    description: "Skip the build step"
    required: false
    default: "false"

  install-args:
    description: "Additional arguments for bun install"
    required: false
    default: ""

outputs:
  node-version:
    description: "Actual Node.js version installed"
    value: ${{ steps.setup-node.outputs.node-version }}

  bun-version:
    description: "Actual Bun version installed"
    value: ${{ steps.setup-bun.outputs.bun-version }}

  build-status:
    description: "Build status: skipped, success, or failed"
    value: ${{ steps.build.outputs.status }}

runs:
  using: composite
  steps:
    - name: Setup Node.js
      id: setup-node
      uses: actions/setup-node@v4
      with:
        node-version: ${{ inputs.node-version }}

    - name: Setup Bun
      id: setup-bun
      uses: oven-sh/setup-bun@v2
      with:
        bun-version: ${{ inputs.bun-version }}

    - name: Install dependencies
      shell: bash
      run: |
        echo "ðŸ“¥ Installing dependencies..."
        if [ -n "${{ inputs.install-args }}" ]; then
          bun install ${{ inputs.install-args }}
        else
          bun install
        fi

    - name: Build project
      id: build
      if: inputs.skip-build != 'true'
      shell: bash
      run: |
        echo "ðŸ”¨ Building project..."
        if bun run build; then
          echo "status=success" >> $GITHUB_OUTPUT
        else
          echo "status=failed" >> $GITHUB_OUTPUT
          exit 1
        fi

    - name: Set skipped status
      id: skip-marker
      if: inputs.skip-build == 'true'
      shell: bash
      run: echo "status=skipped" >> $GITHUB_OUTPUT
